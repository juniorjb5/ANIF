<h1 id="cálculo-del-value-at-risk-var-en-python">📉 <strong>Cálculo del
Value at Risk (VaR) en Python</strong></h1>
<h2 id="introducción">Introducción</h2>
<p>Este análisis es ofrecido por el <strong>Semillero de Investigación
ANIF</strong>, con el objetivo de desarrollar herramientas para la
gestión de riesgos financieros y toma de decisiones en inversiones.</p>
<p>El <strong>Value at Risk (VaR)</strong> es una medida estadística
clave en la administración de riesgos, utilizada para estimar la pérdida
máxima esperada de un portafolio de inversión en un horizonte de tiempo
determinado con un nivel de confianza específico.</p>
<h2 id="métodos-de-cálculo">Métodos de Cálculo</h2>
<p>Existen varios enfoques para calcular el VaR:<br />
1. <strong>Método Histórico</strong>: Basado en datos pasados de
rendimientos.<br />
2. <strong>Varianza-Covarianza (Paramétrico)</strong>: Asume una
distribución normal de rendimientos.<br />
3. <strong>Simulación de Monte Carlo</strong>: Genera múltiples
escenarios aleatorios para estimar pérdidas futuras.</p>
<p>En este proyecto, exploraremos estos métodos con herramientas de
<strong>Python</strong> para evaluar el riesgo de una cartera de
inversión.</p>
<h2 id="librerías-necesarias">📚 Librerías necesarias</h2>
<p>Antes de comenzar, asegúrate de instalar las siguientes
librerías:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>pip install numpy pandas matplotlib scipy yfinance</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#Librerias </span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="im">from</span> dateutil.relativedelta <span class="im">import</span> relativedelta</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span></code></pre></div>
<h1 id="método-histórico"><strong>Método Histórico</strong> 📈</h1>
<p>Nuestro objetivo es calcular el <strong>VaR de un portafolio de
inversión</strong> a partir de datos históricos. Para ello, realizaremos
los siguientes pasos:</p>
<ol style="list-style-type: decimal">
<li>Obtener datos históricos de activos financieros.<br />
</li>
<li>Calcular los rendimientos logarítmicos.</li>
<li>Asignar pesos a cada activo en la cartera.</li>
<li>Implementar los métodos de cálculo del VaR.</li>
<li>Visualizar los resultados mediante gráficos.</li>
</ol>
<p>📌 <strong>Este análisis busca proporcionar herramientas para la toma
de decisiones en gestión de inversiones y evaluación de riesgos
financieros.</strong></p>
<p>¡Comencemos! 🚀</p>
<p><a
href="https://ryanoconnellfinance.com/value-at-risk-analysis-using-python/">Fuente
del código</a></p>
<h2 id="paso-1-obtener-datos-históricos-de-activos-financieros">📌 Paso
1: Obtener datos históricos de activos financieros</h2>
<p>El primer paso en nuestro cálculo del <strong>VaR</strong> es
recopilar datos históricos de los activos que conforman el portafolio.
Estos datos suelen incluir los precios de cierre ajustados de cada
activo en un período determinado.</p>
<p>Para ello, podemos utilizar fuentes como:<br />
- <strong>Yahoo Finance</strong> 📈<br />
- <strong>Google Finance</strong> 📊<br />
- <strong>APIs de datos financieros</strong> 🔗</p>
<p>Disponer de una serie de precios históricos nos permitirá calcular
los rendimientos y analizar la volatilidad del portafolio.</p>
<p>🔍 <strong>Objetivo</strong>: Obtener un dataset confiable con el
historial de precios necesario para el análisis de riesgo.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># 🔹 Permitir que el usuario ingrese la fecha final manualmente (opcional)</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>fecha_final_input <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Ingrese la fecha final (YYYY-MM-DD) o presione Enter para usar la actual: &quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="cf">if</span> fecha_final_input:</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        endDate <span class="op">=</span> dt.datetime.strptime(fecha_final_input, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">&quot;</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Formato de fecha inválido. Use YYYY-MM-DD.&quot;</span>)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    endDate <span class="op">=</span> dt.datetime.now()</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co"># 🔹 Permitir que el usuario ingrese la fecha de inicio o el número de años</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>fecha_inicio_input <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Ingrese la fecha de inicio (YYYY-MM-DD) o presione Enter para calcular desde años atrás: &quot;</span>)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="cf">if</span> fecha_inicio_input:</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>        startDate <span class="op">=</span> dt.datetime.strptime(fecha_inicio_input, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">&quot;</span>)</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Formato de fecha inválido. Use YYYY-MM-DD.&quot;</span>)</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>    <span class="co"># Si el usuario no proporciona una fecha de inicio, restamos &quot;years&quot;</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>    years <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese el número de años de datos históricos: &quot;</span>) <span class="kw">or</span> <span class="dv">15</span>)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="cf">if</span> years <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de años debe ser mayor que 0.&quot;</span>)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    startDate <span class="op">=</span> endDate <span class="op">-</span> relativedelta(years<span class="op">=</span>years)</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co"># 🔹 Lista de tickers a analizar (se puede modificar)</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">&#39;SPY&#39;</span>, <span class="st">&#39;BND&#39;</span>, <span class="st">&#39;GLD&#39;</span>, <span class="st">&#39;QQQ&#39;</span>, <span class="st">&#39;VTI&#39;</span>]</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co"># 🔹 Mostrar información</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔹 Obteniendo datos desde </span><span class="sc">{</span>startDate<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> hasta </span><span class="sc">{</span>endDate<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">.&quot;</span>)</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;🔹 Tickers seleccionados: </span><span class="sc">{</span><span class="st">&#39;, &#39;</span><span class="sc">.</span>join(tickers)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>🔹 Obteniendo datos desde 2010-04-08 hasta 2025-04-08.
🔹 Tickers seleccionados: SPY, BND, GLD, QQQ, VTI</code></pre>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Descargar datos de los tickers seleccionados</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>data <span class="op">=</span> yf.download(tickers, start<span class="op">=</span>startDate, end<span class="op">=</span>endDate)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># 🔍 Imprimir las columnas disponibles</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#print(&quot;Columnas disponibles:&quot;, data.columns)</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># Extraer los datos de cierre correctamente desde MultiIndex</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>adj_close_df <span class="op">=</span> data.xs(<span class="st">&#39;Close&#39;</span>, level<span class="op">=</span><span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Obtiene solo los valores de &#39;Close&#39;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co"># Manejo de valores faltantes (sin warning)</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>adj_close_df <span class="op">=</span> adj_close_df.ffill().dropna()</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co"># Mostrar resultado</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#print(adj_close_df.head())</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co"># Imprimir los primeros 10 registros en formato tabular</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="bu">print</span>(tabulate(adj_close_df.head(<span class="dv">10</span>), headers<span class="op">=</span><span class="st">&quot;keys&quot;</span>, tablefmt<span class="op">=</span><span class="st">&quot;fancy_grid&quot;</span>))</span></code></pre></div>
<pre><code>[*********************100%***********************]  5 of 5 completed

╒═════════════════════╤═════════╤════════╤═════════╤═════════╤═════════╕
│ Date                │     BND │    GLD │     QQQ │     SPY │     VTI │
╞═════════════════════╪═════════╪════════╪═════════╪═════════╪═════════╡
│ 2010-04-08 00:00:00 │ 51.301  │ 112.65 │ 42.5546 │ 90.2556 │ 46.2722 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-09 00:00:00 │ 51.3987 │ 113.64 │ 42.8078 │ 90.8483 │ 46.5853 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-12 00:00:00 │ 51.4508 │ 113.01 │ 42.8427 │ 90.9927 │ 46.6922 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-13 00:00:00 │ 51.555  │ 112.69 │ 43.061  │ 91.0611 │ 46.738  │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-14 00:00:00 │ 51.5159 │ 113.03 │ 43.5761 │ 92.0946 │ 47.3108 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-15 00:00:00 │ 51.5941 │ 113.65 │ 43.7682 │ 92.1706 │ 47.3719 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-16 00:00:00 │ 51.7047 │ 111.24 │ 43.2444 │ 90.704  │ 46.6311 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-19 00:00:00 │ 51.6396 │ 111.15 │ 43.2182 │ 91.0459 │ 46.7533 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-20 00:00:00 │ 51.6917 │ 111.46 │ 43.4364 │ 91.8591 │ 47.1963 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-21 00:00:00 │ 51.7308 │ 112.31 │ 43.6809 │ 91.6919 │ 47.1581 │
╘═════════════════════╧═════════╧════════╧═════════╧═════════╧═════════╛</code></pre>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># Graficar los precios de cierre</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co"># Configurar estilo minimalista</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>sns.set_style(<span class="st">&quot;white&quot;</span>)  <span class="co"># Fondo blanco sin líneas</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co"># Obtener colores suaves de Seaborn</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;muted&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(adj_close_df.columns))</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co"># Graficar cada activo con colores suaves</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="cf">for</span> i, ticker <span class="kw">in</span> <span class="bu">enumerate</span>(adj_close_df.columns):</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>    plt.plot(adj_close_df.index, adj_close_df[ticker], label<span class="op">=</span>ticker, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[i])</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co"># Agregar títulos y etiquetas</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución de los Precios de Cierre Ajustados&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Precio de Cierre Ajustado (USD)&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co"># Eliminar bordes superiores y derechos para un look más limpio</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co"># Rotar fechas para mejor visibilidad</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co"># Agregar leyenda con un diseño discreto</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&quot;Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">10</span>, loc<span class="op">=</span><span class="st">&quot;upper left&quot;</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_7_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># Graficar cada activo con diferentes colores</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;muted&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(adj_close_df.columns))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="cf">for</span> ticker, color <span class="kw">in</span> <span class="bu">zip</span>(adj_close_df.columns, colors):</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    plt.plot(adj_close_df.index, adj_close_df[ticker], label<span class="op">=</span>ticker, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.8</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># Mejoras en la leyenda</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>plt.legend(</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    title<span class="op">=</span><span class="st">&quot;Activos Financieros&quot;</span>,  <span class="co"># Título de la leyenda</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    title_fontsize<span class="op">=</span><span class="dv">12</span>,  <span class="co"># Tamaño del título</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">10</span>,  <span class="co"># Tamaño de las etiquetas</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>,  <span class="co"># Ubicación</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>    bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>),  <span class="co"># Mueve la leyenda fuera del gráfico</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>    frameon<span class="op">=</span><span class="va">True</span>,  <span class="co"># Agrega un borde sutil</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>    fancybox<span class="op">=</span><span class="va">True</span>,  <span class="co"># Borde redondeado</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>    shadow<span class="op">=</span><span class="va">True</span>  <span class="co"># Sombra ligera</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>)</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co"># Mejoras en los ejes y título</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución de los Precios de Cierre de los Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Precio de Cierre&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)  <span class="co"># Líneas de fondo más sutiles</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>plt.tight_layout()  <span class="co"># Ajustar el diseño</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_8_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-2-calcular-los-rendimientos-logarítmicos">📌 Paso 2:
Calcular los rendimientos logarítmicos</h2>
<p>Una vez que tenemos los datos históricos de los activos financieros,
el siguiente paso es calcular los <strong>rendimientos
logarítmicos</strong>.</p>
<p>Los rendimientos logarítmicos se calculan con la siguiente
fórmula:</p>
<p><span class="math display">$$
\begin{aligned}
r_t &amp;= \ln\left(\frac{P_t}{P_{t-1}}\right) \\
\text{donde:} \\
r_t &amp;= \text{rendimiento logarítmico en el período } t, \\
P_t &amp;= \text{precio del activo en el período actual}, \\
P_{t-1} &amp;= \text{precio del activo en el período anterior}.
\end{aligned}
$$</span></p>
<p>🔍 <strong>Objetivo</strong>: Obtener una serie de rendimientos que
nos permitan analizar la distribución del riesgo en el portafolio.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Calcular los rendimientos logarítmicos</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>log_returns <span class="op">=</span> np.log(adj_close_df.div(adj_close_df.shift(<span class="dv">1</span>)))</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Eliminar filas con valores NaN generados por el shift</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>log_returns.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># Imprimir los primeros registros para verificar</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="bu">print</span>(log_returns.head())</span></code></pre></div>
<pre><code>Ticker           BND       GLD       QQQ       SPY       VTI
Date                                                        
2010-04-09  0.001901  0.008750  0.005932  0.006546  0.006744
2010-04-12  0.001013 -0.005559  0.000815  0.001588  0.002292
2010-04-13  0.002023 -0.002836  0.005082  0.000751  0.000981
2010-04-14 -0.000758  0.003013  0.011892  0.011286  0.012181
2010-04-15  0.001516  0.005470  0.004398  0.000824  0.001290</code></pre>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># Crear la figura</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co"># Obtener colores de Seaborn</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;deep&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(log_returns.columns))</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co"># Graficar cada activo</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="cf">for</span> ticker, color <span class="kw">in</span> <span class="bu">zip</span>(log_returns.columns, colors):</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    plt.plot(log_returns.index, log_returns[ticker], label<span class="op">=</span>ticker, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co"># Mejorar la leyenda</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>plt.legend(</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    title<span class="op">=</span><span class="st">&quot;Activos Financieros&quot;</span>, title_fontsize<span class="op">=</span><span class="dv">12</span>, fontsize<span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), frameon<span class="op">=</span><span class="va">True</span>, fancybox<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>)</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co"># Mejorar etiquetas y título</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos de los Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)  <span class="co"># Línea base en 0</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)  <span class="co"># Líneas de fondo más sutiles</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_11_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-3-asignación-de-pesos-a-los-activos">📌 Paso 3: Asignación
de Pesos a los Activos</h2>
<p>Una vez calculados los <strong>rendimientos logarítmicos</strong>, el
siguiente paso es asignar los pesos a cada activo dentro del portafolio.
Estos pesos representan la proporción del capital invertido en cada
activo y juegan un papel clave en la determinación del <strong>riesgo
total</strong>.</p>
<h3 id="métodos-para-asignar-los-pesos">🎯 Métodos para asignar los
pesos</h3>
<p>Existen diferentes estrategias para asignar los pesos en un
portafolio:</p>
<ul>
<li><strong>Pesos iguales</strong> 📊: Se asigna el mismo porcentaje a
cada activo.<br />
</li>
<li><strong>Proporcional al valor de mercado</strong> 💰: Se basa en la
capitalización de mercado de cada activo.<br />
</li>
<li><strong>Optimización de riesgo-retorno</strong> 📈: Se ajustan los
pesos para minimizar la volatilidad o maximizar el rendimiento
esperado.</li>
</ul>
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co"># Definir el valor total del portafolio  </span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>portfolio_value <span class="op">=</span> <span class="dv">1_000_000</span>  <span class="co"># 1 millón de dólares  </span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co"># Asignar pesos a los activos (deben sumar 1 y coincidir con los tickers)  </span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>])  </span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># Validaciones: Asegurar que los pesos coincidan con el número de activos y sumen 1  </span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(weights) <span class="op">!=</span> <span class="bu">len</span>(tickers):  </span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Error: Hay </span><span class="sc">{</span><span class="bu">len</span>(tickers)<span class="sc">}</span><span class="ss"> activos, pero </span><span class="sc">{</span><span class="bu">len</span>(weights)<span class="sc">}</span><span class="ss"> pesos asignados.&quot;</span>)  </span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> np.isclose(np.<span class="bu">sum</span>(weights), <span class="dv">1</span>):  </span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Error: La suma de los pesos debe ser exactamente 1.&quot;</span>)  </span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co"># Mostrar los pesos asignados  </span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;✅ Pesos asignados correctamente:&quot;</span>, weights)  </span></code></pre></div>
<pre><code>✅ Pesos asignados correctamente: [0.2 0.3 0.2 0.2 0.1]</code></pre>
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Calcular los rendimientos históricos del portafolio</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co"># Multiplicamos los rendimientos logarítmicos de cada activo por su peso en el portafolio</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>historical_returns <span class="op">=</span> (log_returns <span class="op">*</span> weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co"># Imprimir los rendimientos históricos del portafolio</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="bu">print</span>(historical_returns)</span></code></pre></div>
<pre><code>Date
2010-04-09    0.006175
2010-04-12   -0.000755
2010-04-13    0.000819
2010-04-14    0.006606
2010-04-15    0.003118
                ...   
2025-04-01    0.002541
2025-04-02    0.003955
2025-04-03   -0.027060
2025-04-04   -0.037876
2025-04-07   -0.009143
Length: 3773, dtype: float64</code></pre>
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)  <span class="co"># Estilo limpio</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos históricos del portafolio</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>plt.plot(historical_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">&quot;Rendimientos Históricos&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co"># Títulos y etiquetas</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos del Portafolio&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co"># Agregar línea base en y=0</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co"># Leyenda mejorada</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>plt.legend(frameon<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&quot;upper right&quot;</span>)</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co"># Mostrar gráfico</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_15_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Permitir que el usuario defina la ventana de días</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese la cantidad de días para la ventana móvil: &quot;</span>))</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co"># Validar que el valor ingresado sea positivo y razonable</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="cf">if</span> days <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> days <span class="op">&gt;</span> <span class="bu">len</span>(historical_returns):</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de días debe estar entre 1 y el total de registros disponibles.&quot;</span>)</span></code></pre></div>
<pre><code>---------------------------------------------------------------------------

ValueError                                Traceback (most recent call last)

Cell In[84], line 2
      1 # Permitir que el usuario defina la ventana de días
----&gt; 2 days = int(input(&quot;Ingrese la cantidad de días para la ventana móvil: &quot;))
      4 # Validar que el valor ingresado sea positivo y razonable
      5 if days &lt;= 0 or days &gt; len(historical_returns):


ValueError: invalid literal for int() with base 10: &#39;&#39;</code></pre>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Rendimientos acumulados en ventanas móviles</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>range_returns <span class="op">=</span> historical_returns.rolling(window<span class="op">=</span>days).<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x <span class="op">+</span> <span class="dv">1</span>).prod() <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos acumulados</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>plt.plot(range_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;Rendimiento acumulado (</span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días)&#39;</span>)</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Línea en 0 para referencia</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>)</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento acumulado&quot;</span>)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Rendimientos Acumulados en Ventanas de </span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días&quot;</span>)</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>plt.legend()</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_17_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-3-asignación-de-pesos-a-los-activos-1">📌 Paso 3:
Asignación de Pesos a los Activos</h2>
<p>Una vez calculados los <strong>rendimientos logarítmicos</strong>, el
siguiente paso es asignar los pesos a cada activo dentro del portafolio.
Estos pesos representan la proporción del capital invertido en cada
activo y juegan un papel clave en la determinación del <strong>riesgo
total</strong>.</p>
<h3 id="métodos-para-asignar-los-pesos-1">🎯 Métodos para asignar los
pesos</h3>
<p>Existen diferentes estrategias para asignar los pesos en un
portafolio:</p>
<ul>
<li><strong>Pesos iguales</strong> 📊: Se asigna el mismo porcentaje a
cada activo.<br />
</li>
<li><strong>Proporcional al valor de mercado</strong> 💰: Se basa en la
capitalización de mercado de cada activo.<br />
</li>
<li><strong>Optimización de riesgo-retorno</strong> 📈: Se ajustan los
pesos para minimizar la volatilidad o maximizar el rendimiento
esperado.</li>
</ul>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co"># Definir el valor total del portafolio  </span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>portfolio_value <span class="op">=</span> <span class="dv">1_000_000</span>  <span class="co"># 1 millón de dólares  </span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co"># Asignar pesos a los activos (deben sumar 1 y coincidir con los tickers)  </span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>])  </span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co"># Validaciones: Asegurar que los pesos coincidan con el número de activos y sumen 1  </span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(weights) <span class="op">!=</span> <span class="bu">len</span>(tickers):  </span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Error: Hay </span><span class="sc">{</span><span class="bu">len</span>(tickers)<span class="sc">}</span><span class="ss"> activos, pero </span><span class="sc">{</span><span class="bu">len</span>(weights)<span class="sc">}</span><span class="ss"> pesos asignados.&quot;</span>)  </span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> np.isclose(np.<span class="bu">sum</span>(weights), <span class="dv">1</span>):  </span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Error: La suma de los pesos debe ser exactamente 1.&quot;</span>)  </span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co"># Mostrar los pesos asignados  </span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;✅ Pesos asignados correctamente:&quot;</span>, weights)  </span></code></pre></div>
<pre><code>✅ Pesos asignados correctamente: [0.2 0.3 0.2 0.2 0.1]</code></pre>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># Calcular los rendimientos históricos del portafolio</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co"># Multiplicamos los rendimientos logarítmicos de cada activo por su peso en el portafolio</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>historical_returns <span class="op">=</span> (log_returns <span class="op">*</span> weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co"># Imprimir los rendimientos históricos del portafolio</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="bu">print</span>(historical_returns)</span></code></pre></div>
<pre><code>Date
2010-04-09    0.006175
2010-04-12   -0.000755
2010-04-13    0.000818
2010-04-14    0.006606
2010-04-15    0.003118
                ...   
2025-04-01    0.002541
2025-04-02    0.003955
2025-04-03   -0.027060
2025-04-04   -0.037876
2025-04-07   -0.009143
Length: 3773, dtype: float64</code></pre>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)  <span class="co"># Estilo limpio</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos históricos del portafolio</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>plt.plot(historical_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">&quot;Rendimientos Históricos&quot;</span>)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co"># Títulos y etiquetas</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos del Portafolio&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co"># Agregar línea base en y=0</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co"># Leyenda mejorada</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>plt.legend(frameon<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&quot;upper right&quot;</span>)</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co"># Mostrar gráfico</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_21_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># Permitir que el usuario defina la ventana de días</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese la cantidad de días para la ventana móvil: &quot;</span>))</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co"># Validar que el valor ingresado sea positivo y razonable</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="cf">if</span> days <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> days <span class="op">&gt;</span> <span class="bu">len</span>(historical_returns):</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de días debe estar entre 1 y el total de registros disponibles.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># Rendimientos acumulados en ventanas móviles</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>range_returns <span class="op">=</span> historical_returns.rolling(window<span class="op">=</span>days).<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x <span class="op">+</span> <span class="dv">1</span>).prod() <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos acumulados</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>plt.plot(range_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;Rendimiento acumulado (</span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días)&#39;</span>)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Línea en 0 para referencia</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>)</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento acumulado&quot;</span>)</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Rendimientos Acumulados en Ventanas de </span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días&quot;</span>)</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_23_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-4-implementación-de-los-métodos-de-cálculo-del-var">📌 Paso
4: Implementación de los Métodos de Cálculo del VaR</h2>
<p>Una vez definidos los pesos del portafolio, el siguiente paso
consiste en implementar los diferentes métodos de cálculo del Valor en
Riesgo (VaR). Este valor representa la pérdida máxima esperada en un
horizonte temporal determinado y con un cierto nivel de confianza.</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>confidence_interval <span class="op">=</span> <span class="fl">0.99</span>  <span class="co"># Nivel de confianza del 99%</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co"># Calcular el VaR utilizando percentiles</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>VaR <span class="op">=</span> <span class="op">-</span>np.percentile(range_returns, <span class="dv">100</span> <span class="op">-</span> (confidence_interval <span class="op">*</span> <span class="dv">100</span>)) <span class="op">*</span> portfolio_value</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co"># Imprimir el resultado de forma clara</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Valor en Riesgo (VaR) al </span><span class="sc">{</span>confidence_interval<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">% de confianza: $</span><span class="sc">{</span>VaR<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>Valor en Riesgo (VaR) al 99% de confianza: $103,878.31</code></pre>
<h2 id="paso-5-visualización-de-los-resultados-mediante-gráficos">📌
Paso 5: Visualización de los Resultados mediante Gráficos</h2>
<p>Una vez calculado el VaR utilizando los distintos métodos, es
fundamental visualizar los resultados para interpretar de forma clara y
rápida el riesgo del portafolio.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>return_window <span class="op">=</span> days</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>range_returns <span class="op">=</span> historical_returns.rolling(window<span class="op">=</span>return_window).<span class="bu">sum</span>().dropna()</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>range_returns_dollar <span class="op">=</span> range_returns <span class="op">*</span> portfolio_value</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="co"># Configurar el estilo de la gráfica</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="co"># Histogram + KDE</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>sns.histplot(range_returns_dollar, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a><span class="co"># Línea de VaR</span></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>plt.axvline(<span class="op">-</span>VaR, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;VaR (</span><span class="sc">{</span>confidence_interval<span class="sc">:.0%}</span><span class="ss"> Confianza): $</span><span class="sc">{</span>VaR<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a><span class="co"># Etiquetas y título</span></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>plt.xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>return_window<span class="sc">}</span><span class="ss">-Day Portfolio Return (Dollar Value)&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>plt.title(<span class="ss">f&#39;Distribution of Portfolio </span><span class="sc">{</span>return_window<span class="sc">}</span><span class="ss">-Day Returns</span><span class="ch">\n</span><span class="ss">(Value at Risk - </span><span class="sc">{</span>confidence_interval<span class="sc">:.0%}</span><span class="ss"> Confidence Level)&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a><span class="co"># Leyenda mejorada</span></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&quot;upper left&quot;</span>, frameon<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_27_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h1 id="método-paramétrico"><strong>Método Paramétrico</strong> 📊</h1>
<p>El <strong>método paramétrico</strong>, también conocido como
<strong>varianza-covarianza</strong>, es una de las formas más comunes
para calcular el <strong>Valor en Riesgo (VaR)</strong>. Se basa en la
suposición de que los rendimientos de los activos siguen una
<strong>distribución normal</strong> y utiliza sus estadísticas clave,
como la <strong>media</strong> y la <strong>desviación
estándar</strong>, para estimar posibles pérdidas.</p>
<p>Nuestro objetivo es calcular el VaR de un portafolio de inversión
utilizando el enfoque paramétrico (Var-Cov). Para ello, seguiremos los
siguientes pasos:</p>
<ol style="list-style-type: decimal">
<li>Obtener datos históricos de activos financieros.</li>
<li>Calcular los rendimientos logarítmicos.</li>
<li>Asignar pesos a cada activo en la cartera.</li>
<li>Calcular el VaR utilizando la fórmula basada en la media, la
desviación estándar y el nivel de confianza.</li>
<li>Visualizar los resultados con gráficos.</li>
</ol>
<p>📌 Este análisis permite estimar el riesgo bajo supuestos
estadísticos que simplifican el proceso, siendo útil para decisiones
rápidas y escenarios normales de mercado.</p>
<p>¡Vamos allá! 📊</p>
<p><a
href="https://ryanoconnellfinance.com/estimating-value-at-risk-with-python/">Fuente
del código</a></p>
<h2 id="paso-1-obtener-datos-históricos-de-activos-financieros-1">📌
Paso 1: Obtener datos históricos de activos financieros</h2>
<p>El primer paso en nuestro cálculo del <strong>VaR</strong> es
recopilar datos históricos de los activos que conforman el portafolio.
Estos datos suelen incluir los precios de cierre ajustados de cada
activo en un período determinado.</p>
<p>Para ello, podemos utilizar fuentes como:<br />
- <strong>Yahoo Finance</strong> 📈<br />
- <strong>Google Finance</strong> 📊<br />
- <strong>APIs de datos financieros</strong> 🔗</p>
<p>Disponer de una serie de precios históricos nos permitirá calcular
los rendimientos y analizar la volatilidad del portafolio.</p>
<p>🔍 <strong>Objetivo</strong>: Obtener un dataset confiable con el
historial de precios necesario para el análisis de riesgo.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># 🔹 Permitir que el usuario ingrese la fecha final manualmente (opcional)</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>fecha_final_input <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Ingrese la fecha final (YYYY-MM-DD) o presione Enter para usar la actual: &quot;</span>)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="cf">if</span> fecha_final_input:</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>        endDate <span class="op">=</span> dt.datetime.strptime(fecha_final_input, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">&quot;</span>)</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Formato de fecha inválido. Use YYYY-MM-DD.&quot;</span>)</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>    endDate <span class="op">=</span> dt.datetime.now()</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="co"># 🔹 Permitir que el usuario ingrese la fecha de inicio o el número de años</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>fecha_inicio_input <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Ingrese la fecha de inicio (YYYY-MM-DD) o presione Enter para calcular desde años atrás: &quot;</span>)</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="cf">if</span> fecha_inicio_input:</span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>        startDate <span class="op">=</span> dt.datetime.strptime(fecha_inicio_input, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">&quot;</span>)</span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Formato de fecha inválido. Use YYYY-MM-DD.&quot;</span>)</span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a>    <span class="co"># Si el usuario no proporciona una fecha de inicio, restamos &quot;years&quot;</span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a>    years <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese el número de años de datos históricos: &quot;</span>) <span class="kw">or</span> <span class="dv">15</span>)</span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a>    <span class="cf">if</span> years <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de años debe ser mayor que 0.&quot;</span>)</span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a>    startDate <span class="op">=</span> endDate <span class="op">-</span> relativedelta(years<span class="op">=</span>years)</span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="co"># 🔹 Lista de tickers a analizar (se puede modificar)</span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">&#39;SPY&#39;</span>, <span class="st">&#39;BND&#39;</span>, <span class="st">&#39;GLD&#39;</span>, <span class="st">&#39;QQQ&#39;</span>, <span class="st">&#39;VTI&#39;</span>]</span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a><span class="co"># 🔹 Mostrar información</span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔹 Obteniendo datos desde </span><span class="sc">{</span>startDate<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> hasta </span><span class="sc">{</span>endDate<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">.&quot;</span>)</span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;🔹 Tickers seleccionados: </span><span class="sc">{</span><span class="st">&#39;, &#39;</span><span class="sc">.</span>join(tickers)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>🔹 Obteniendo datos desde 2010-04-07 hasta 2025-04-07.
🔹 Tickers seleccionados: SPY, BND, GLD, QQQ, VTI</code></pre>
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># Descargar datos de los tickers seleccionados</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>data <span class="op">=</span> yf.download(tickers, start<span class="op">=</span>startDate, end<span class="op">=</span>endDate)</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co"># 🔍 Imprimir las columnas disponibles</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co">#print(&quot;Columnas disponibles:&quot;, data.columns)</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="co"># Extraer los datos de cierre correctamente desde MultiIndex</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>adj_close_df <span class="op">=</span> data.xs(<span class="st">&#39;Close&#39;</span>, level<span class="op">=</span><span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Obtiene solo los valores de &#39;Close&#39;</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="co"># Manejo de valores faltantes (sin warning)</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>adj_close_df <span class="op">=</span> adj_close_df.ffill().dropna()</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="co"># Mostrar resultado</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="co">#print(adj_close_df.head())</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a><span class="co"># Imprimir los primeros 10 registros en formato tabular</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="bu">print</span>(tabulate(adj_close_df.head(<span class="dv">10</span>), headers<span class="op">=</span><span class="st">&quot;keys&quot;</span>, tablefmt<span class="op">=</span><span class="st">&quot;fancy_grid&quot;</span>))</span></code></pre></div>
<pre><code>YF.download() has changed argument auto_adjust default to True


[*********************100%***********************]  5 of 5 completed

╒═════════════════════╤═════════╤════════╤═════════╤═════════╤═════════╕
│ Date                │     BND │    GLD │     QQQ │     SPY │     VTI │
╞═════════════════════╪═════════╪════════╪═════════╪═════════╪═════════╡
│ 2010-04-08 00:00:00 │ 51.301  │ 112.65 │ 42.5546 │ 90.2556 │ 46.2722 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-09 00:00:00 │ 51.3987 │ 113.64 │ 42.8078 │ 90.8484 │ 46.5853 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-12 00:00:00 │ 51.4508 │ 113.01 │ 42.8427 │ 90.9927 │ 46.6922 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-13 00:00:00 │ 51.555  │ 112.69 │ 43.061  │ 91.0611 │ 46.738  │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-14 00:00:00 │ 51.5159 │ 113.03 │ 43.5761 │ 92.0946 │ 47.3108 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-15 00:00:00 │ 51.5941 │ 113.65 │ 43.7682 │ 92.1706 │ 47.3719 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-16 00:00:00 │ 51.7047 │ 111.24 │ 43.2443 │ 90.7039 │ 46.6311 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-19 00:00:00 │ 51.6396 │ 111.15 │ 43.2182 │ 91.0459 │ 46.7533 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-20 00:00:00 │ 51.6917 │ 111.46 │ 43.4364 │ 91.859  │ 47.1962 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-21 00:00:00 │ 51.7308 │ 112.31 │ 43.6809 │ 91.6919 │ 47.1581 │
╘═════════════════════╧═════════╧════════╧═════════╧═════════╧═════════╛</code></pre>
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="co"># Graficar los precios de cierre</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a><span class="co"># Configurar estilo minimalista</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>sns.set_style(<span class="st">&quot;white&quot;</span>)  <span class="co"># Fondo blanco sin líneas</span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a><span class="co"># Obtener colores suaves de Seaborn</span></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;muted&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(adj_close_df.columns))</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="co"># Graficar cada activo con colores suaves</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a><span class="cf">for</span> i, ticker <span class="kw">in</span> <span class="bu">enumerate</span>(adj_close_df.columns):</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>    plt.plot(adj_close_df.index, adj_close_df[ticker], label<span class="op">=</span>ticker, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[i])</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a><span class="co"># Agregar títulos y etiquetas</span></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución de los Precios de Cierre Ajustados&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Precio de Cierre Ajustado (USD)&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a><span class="co"># Eliminar bordes superiores y derechos para un look más limpio</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a><span class="co"># Rotar fechas para mejor visibilidad</span></span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a><span class="co"># Agregar leyenda con un diseño discreto</span></span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&quot;Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">10</span>, loc<span class="op">=</span><span class="st">&quot;upper left&quot;</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_32_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-2-calcular-los-rendimientos-logarítmicos-1">📌 Paso 2:
Calcular los rendimientos logarítmicos</h2>
<p>Una vez que tenemos los datos históricos de los activos financieros,
el siguiente paso es calcular los <strong>rendimientos
logarítmicos</strong>.</p>
<p>Los rendimientos logarítmicos se calculan con la siguiente
fórmula:</p>
<p><span class="math display">$$
\begin{aligned}
r_t &amp;= \ln\left(\frac{P_t}{P_{t-1}}\right) \\
\text{donde:} \\
r_t &amp;= \text{rendimiento logarítmico en el período } t, \\
P_t &amp;= \text{precio del activo en el período actual}, \\
P_{t-1} &amp;= \text{precio del activo en el período anterior}.
\end{aligned}
$$</span></p>
<p>🔍 <strong>Objetivo</strong>: Obtener una serie de rendimientos que
nos permitan analizar la distribución del riesgo en el portafolio.</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># Solicitar al usuario el número de días para la ventana móvil</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese el número de días para calcular los rendimientos acumulados: &quot;</span>))</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="co"># Calcular los rendimientos acumulados en la ventana de &#39;days&#39; días</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>historical_x_day_returns <span class="op">=</span> historical_returns.rolling(window<span class="op">=</span>days).<span class="bu">sum</span>()</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="co"># Eliminar valores NaN generados por la ventana móvil</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>historical_x_day_returns.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a><span class="co"># Mostrar los primeros valores calculados</span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a><span class="bu">print</span>(historical_x_day_returns.head())</span></code></pre></div>
<pre><code>Date
2010-04-15    0.015962
2010-04-16   -0.003407
2010-04-19   -0.002254
2010-04-20    0.001694
2010-04-21   -0.001804
dtype: float64</code></pre>
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="co"># Crear la figura</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="co"># Obtener colores de Seaborn</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;deep&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(log_returns.columns))</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a><span class="co"># Graficar cada activo</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a><span class="cf">for</span> ticker, color <span class="kw">in</span> <span class="bu">zip</span>(log_returns.columns, colors):</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>    plt.plot(log_returns.index, log_returns[ticker], label<span class="op">=</span>ticker, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a><span class="co"># Mejorar la leyenda</span></span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>plt.legend(</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>    title<span class="op">=</span><span class="st">&quot;Activos Financieros&quot;</span>, title_fontsize<span class="op">=</span><span class="dv">12</span>, fontsize<span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), frameon<span class="op">=</span><span class="va">True</span>, fancybox<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>)</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a><span class="co"># Mejorar etiquetas y título</span></span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos de los Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)  <span class="co"># Línea base en 0</span></span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)  <span class="co"># Líneas de fondo más sutiles</span></span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_35_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-3-asignación-de-pesos-a-los-activos-2">📌 Paso 3:
Asignación de Pesos a los Activos</h2>
<p>Una vez calculados los <strong>rendimientos logarítmicos</strong>, el
siguiente paso es asignar los pesos a cada activo dentro del portafolio.
Estos pesos representan la proporción del capital invertido en cada
activo y juegan un papel clave en la determinación del <strong>riesgo
total</strong>.</p>
<h3 id="métodos-para-asignar-los-pesos-2">🎯 Métodos para asignar los
pesos</h3>
<p>Existen diferentes estrategias para asignar los pesos en un
portafolio:</p>
<ul>
<li><strong>Pesos iguales</strong> 📊: Se asigna el mismo porcentaje a
cada activo.<br />
</li>
<li><strong>Proporcional al valor de mercado</strong> 💰: Se basa en la
capitalización de mercado de cada activo.<br />
</li>
<li><strong>Optimización de riesgo-retorno</strong> 📈: Se ajustan los
pesos para minimizar la volatilidad o maximizar el rendimiento
esperado.</li>
</ul>
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="co"># Definir el valor total del portafolio  </span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>portfolio_value <span class="op">=</span> <span class="dv">1_000_000</span>  <span class="co"># 1 millón de dólares  </span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="co"># Asignar pesos a los activos (deben sumar 1 y coincidir con los tickers)  </span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>])  </span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="co"># Validaciones: Asegurar que los pesos coincidan con el número de activos y sumen 1  </span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(weights) <span class="op">!=</span> <span class="bu">len</span>(tickers):  </span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Error: Hay </span><span class="sc">{</span><span class="bu">len</span>(tickers)<span class="sc">}</span><span class="ss"> activos, pero </span><span class="sc">{</span><span class="bu">len</span>(weights)<span class="sc">}</span><span class="ss"> pesos asignados.&quot;</span>)  </span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> np.isclose(np.<span class="bu">sum</span>(weights), <span class="dv">1</span>):  </span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Error: La suma de los pesos debe ser exactamente 1.&quot;</span>)  </span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="co"># Mostrar los pesos asignados  </span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;✅ Pesos asignados correctamente:&quot;</span>, weights)  </span></code></pre></div>
<pre><code>✅ Pesos asignados correctamente: [0.2 0.3 0.2 0.2 0.1]</code></pre>
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co"># Calcular los rendimientos históricos del portafolio</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="co"># Multiplicamos los rendimientos logarítmicos de cada activo por su peso en el portafolio</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>historical_returns <span class="op">=</span> (log_returns <span class="op">*</span> weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="co"># Imprimir los rendimientos históricos del portafolio</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="bu">print</span>(historical_returns)</span></code></pre></div>
<pre><code>Date
2010-04-09    0.006175
2010-04-12   -0.000755
2010-04-13    0.000818
2010-04-14    0.006606
2010-04-15    0.003118
                ...   
2025-04-01    0.002541
2025-04-02    0.003955
2025-04-03   -0.027060
2025-04-04   -0.037876
2025-04-07   -0.009143
Length: 3773, dtype: float64</code></pre>
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)  <span class="co"># Estilo limpio</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos históricos del portafolio</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>plt.plot(historical_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">&quot;Rendimientos Históricos&quot;</span>)</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="co"># Títulos y etiquetas</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos del Portafolio&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a><span class="co"># Agregar línea base en y=0</span></span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a><span class="co"># Leyenda mejorada</span></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a>plt.legend(frameon<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&quot;upper right&quot;</span>)</span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a><span class="co"># Mostrar gráfico</span></span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_39_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="co"># Permitir que el usuario defina la ventana de días</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese la cantidad de días para la ventana móvil: &quot;</span>))</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a><span class="co"># Validar que el valor ingresado sea positivo y razonable</span></span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a><span class="cf">if</span> days <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> days <span class="op">&gt;</span> <span class="bu">len</span>(historical_returns):</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de días debe estar entre 1 y el total de registros disponibles.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co"># Rendimientos acumulados en ventanas móviles</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>range_returns <span class="op">=</span> historical_returns.rolling(window<span class="op">=</span>days).<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x <span class="op">+</span> <span class="dv">1</span>).prod() <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos acumulados</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>plt.plot(range_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;Rendimiento acumulado (</span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días)&#39;</span>)</span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Línea en 0 para referencia</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>)</span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento acumulado&quot;</span>)</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Rendimientos Acumulados en Ventanas de </span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días&quot;</span>)</span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a>plt.legend()</span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_41_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-4-implementación-de-los-métodos-de-cálculo-del-var-1">📌
Paso 4: Implementación de los Métodos de Cálculo del VaR</h2>
<p>Una vez definidos los pesos del portafolio, el siguiente paso
consiste en implementar los diferentes métodos de cálculo del Valor en
Riesgo (VaR). Este valor representa la pérdida máxima esperada en un
horizonte temporal determinado y con un cierto nivel de confianza.</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co"># Calcular la matriz de covarianza anualizada (suponiendo 252 días de mercado al año)</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>cov_matrix <span class="op">=</span> log_returns.cov() <span class="op">*</span> <span class="dv">252</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a><span class="co"># Calcular la desviación estándar del portafolio (volatilidad)</span></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>portfolio_std_dev <span class="op">=</span> np.sqrt(weights.T <span class="op">@</span> cov_matrix <span class="op">@</span> weights)</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a><span class="co"># Imprimir el resultado</span></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Desviación estándar del portafolio (Volatilidad Anualizada): </span><span class="sc">{</span>portfolio_std_dev<span class="sc">:.6f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>Desviación estándar del portafolio (Volatilidad Anualizada): 0.106980</code></pre>
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="co"># Definir los niveles de confianza para el cálculo del VaR</span></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>confidence_levels <span class="op">=</span> [<span class="fl">0.90</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>]</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a><span class="co"># Lista para almacenar los valores de VaR correspondientes a cada nivel de confianza</span></span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>VaRs <span class="op">=</span> []</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a><span class="co"># Calcular el VaR para cada nivel de confianza</span></span>
<span id="cb47-9"><a href="#cb47-9" tabindex="-1"></a><span class="cf">for</span> cl <span class="kw">in</span> confidence_levels:</span>
<span id="cb47-10"><a href="#cb47-10" tabindex="-1"></a>    <span class="co"># Cálculo del VaR usando el método paramétrico basado en la distribución normal</span></span>
<span id="cb47-11"><a href="#cb47-11" tabindex="-1"></a>    VaR <span class="op">=</span> portfolio_value <span class="op">*</span> (</span>
<span id="cb47-12"><a href="#cb47-12" tabindex="-1"></a>        norm.ppf(<span class="dv">1</span> <span class="op">-</span> cl) <span class="op">*</span> portfolio_std_dev <span class="op">*</span> np.sqrt(days <span class="op">/</span> <span class="dv">252</span>) <span class="op">-</span> historical_returns.mean() <span class="op">*</span> days</span>
<span id="cb47-13"><a href="#cb47-13" tabindex="-1"></a>    )</span>
<span id="cb47-14"><a href="#cb47-14" tabindex="-1"></a>    </span>
<span id="cb47-15"><a href="#cb47-15" tabindex="-1"></a>    <span class="co"># Almacenar el resultado</span></span>
<span id="cb47-16"><a href="#cb47-16" tabindex="-1"></a>    VaRs.append(VaR)</span>
<span id="cb47-17"><a href="#cb47-17" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" tabindex="-1"></a><span class="co"># Imprimir los resultados</span></span>
<span id="cb47-19"><a href="#cb47-19" tabindex="-1"></a><span class="cf">for</span> cl, var <span class="kw">in</span> <span class="bu">zip</span>(confidence_levels, VaRs):</span>
<span id="cb47-20"><a href="#cb47-20" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;VaR al </span><span class="sc">{</span>cl<span class="sc">:.0%}</span><span class="ss"> de confianza: $</span><span class="sc">{</span>var<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>VaR al 90% de confianza: $-21,045.50
VaR al 95% de confianza: $-26,520.14
VaR al 99% de confianza: $-36,789.65</code></pre>
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="co"># Imprimir encabezado con formato alineado</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;</span><span class="sc">{</span><span class="st">&quot;Confidence Level&quot;</span><span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span><span class="st">&quot;Value at Risk (VaR)&quot;</span><span class="sc">:&gt;20}</span><span class="ss">&#39;</span>)</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;-&#39;</span> <span class="op">*</span> <span class="dv">45</span>)</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a><span class="co"># Imprimir los valores de VaR para cada nivel de confianza</span></span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a><span class="cf">for</span> cl, VaR <span class="kw">in</span> <span class="bu">zip</span>(confidence_levels, VaRs):</span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="sc">{</span>cl <span class="op">*</span> <span class="dv">100</span><span class="sc">:&gt;6.0f}</span><span class="ss">% </span><span class="sc">{</span><span class="st">&quot;&quot;</span><span class="sc">:&lt;8}</span><span class="ss"> $</span><span class="sc">{</span>VaR<span class="sc">:</span><span class="op">&gt;</span><span class="dv">15</span><span class="sc">,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<pre><code>Confidence Level      Value at Risk (VaR)
---------------------------------------------
    90%          $     -21,045.50
    95%          $     -26,520.14
    99%          $     -36,789.65</code></pre>
<h2 id="paso-5-visualización-de-los-resultados-mediante-gráficos-1">📌
Paso 5: Visualización de los Resultados mediante Gráficos</h2>
<p>Una vez calculado el VaR utilizando los distintos métodos, es
fundamental visualizar los resultados para interpretar de forma clara y
rápida el riesgo del portafolio.</p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co"># Convert returns to dollar values for the histogram</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>historical_x_day_returns_dollar <span class="op">=</span> historical_x_day_returns <span class="op">*</span> portfolio_value</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a><span class="co"># Crear figura y eje</span></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="co"># Histograma de los rendimientos</span></span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a>sns.histplot(historical_x_day_returns_dollar, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&#39;royalblue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>days<span class="sc">}</span><span class="ss">-Day Returns&#39;</span>)</span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a><span class="co"># Agregar líneas verticales para el VaR en cada nivel de confianza</span></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&#39;red&#39;</span>, <span class="st">&#39;darkorange&#39;</span>, <span class="st">&#39;purple&#39;</span>]  <span class="co"># Colores diferenciados para cada VaR</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a><span class="cf">for</span> cl, VaR, color <span class="kw">in</span> <span class="bu">zip</span>(confidence_levels, VaRs, colors):</span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a>    plt.axvline(x<span class="op">=</span>VaR, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;VaR </span><span class="sc">{</span><span class="bu">int</span>(cl <span class="op">*</span> <span class="dv">100</span>)<span class="sc">}</span><span class="ss">%: $</span><span class="sc">{</span><span class="op">-</span>VaR<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a><span class="co"># Etiquetas y título</span></span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a>plt.xlabel(<span class="ss">f&#39;</span><span class="sc">{</span>days<span class="sc">}</span><span class="ss">-Day Portfolio Return ($)&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Density&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a>plt.title(<span class="ss">f&#39;Distribution of Portfolio </span><span class="sc">{</span>days<span class="sc">}</span><span class="ss">-Day Returns with VaR Levels&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a><span class="co"># Cuadrícula sutil para mejor visualización</span></span>
<span id="cb51-21"><a href="#cb51-21" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb51-22"><a href="#cb51-22" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" tabindex="-1"></a><span class="co"># Mejorar la leyenda con borde y ubicación óptima</span></span>
<span id="cb51-24"><a href="#cb51-24" tabindex="-1"></a>plt.legend(frameon<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span>, loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb51-25"><a href="#cb51-25" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" tabindex="-1"></a><span class="co"># Mostrar gráfico</span></span>
<span id="cb51-27"><a href="#cb51-27" tabindex="-1"></a>plt.show()</span>
<span id="cb51-28"><a href="#cb51-28" tabindex="-1"></a></span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_47_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h1 id="método-simulación-monte-carlo"><strong>Método Simulación Monte
Carlo</strong> 🎲</h1>
<p>Nuestro objetivo es calcular el VaR de un portafolio de inversión
mediante el método de simulación Monte Carlo. Para lograrlo,
realizaremos los siguientes pasos:</p>
<ol style="list-style-type: decimal">
<li>Obtener datos históricos de activos financieros.</li>
<li>Calcular los rendimientos logarítmicos.</li>
<li>Asignar pesos a cada activo en la cartera.</li>
<li>Generar múltiples escenarios posibles de precios futuros utilizando
simulaciones aleatorias.</li>
<li>Calcular los rendimientos simulados del portafolio.</li>
<li>Visualizar los resultados con gráficos.</li>
</ol>
<p>📌 Este enfoque proporciona una visión más completa del riesgo, al
considerar múltiples trayectorias posibles del mercado y no depender de
una distribución específica.</p>
<p>¡Simulemos el futuro! 🧪📉</p>
<p><a
href="https://ryanoconnellfinance.com/how-to-calculate-value-at-risk/">Fuente
del código</a></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span></code></pre></div>
<h2 id="paso-1-obtener-datos-históricos-de-activos-financieros-2">📌
Paso 1: Obtener datos históricos de activos financieros</h2>
<p>El primer paso en nuestro cálculo del <strong>VaR</strong> es
recopilar datos históricos de los activos que conforman el portafolio.
Estos datos suelen incluir los precios de cierre ajustados de cada
activo en un período determinado.</p>
<p>Para ello, podemos utilizar fuentes como:<br />
- <strong>Yahoo Finance</strong> 📈<br />
- <strong>Google Finance</strong> 📊<br />
- <strong>APIs de datos financieros</strong> 🔗</p>
<p>Disponer de una serie de precios históricos nos permitirá calcular
los rendimientos y analizar la volatilidad del portafolio.</p>
<p>🔍 <strong>Objetivo</strong>: Obtener un dataset confiable con el
historial de precios necesario para el análisis de riesgo.</p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co"># 🔹 Permitir que el usuario ingrese la fecha final manualmente (opcional)</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>fecha_final_input <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Ingrese la fecha final (YYYY-MM-DD) o presione Enter para usar la actual: &quot;</span>)</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a><span class="cf">if</span> fecha_final_input:</span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>        endDate <span class="op">=</span> dt.datetime.strptime(fecha_final_input, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">&quot;</span>)</span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Formato de fecha inválido. Use YYYY-MM-DD.&quot;</span>)</span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a>    endDate <span class="op">=</span> dt.datetime.now()</span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a><span class="co"># 🔹 Permitir que el usuario ingrese la fecha de inicio o el número de años</span></span>
<span id="cb53-13"><a href="#cb53-13" tabindex="-1"></a>fecha_inicio_input <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;Ingrese la fecha de inicio (YYYY-MM-DD) o presione Enter para calcular desde años atrás: &quot;</span>)</span>
<span id="cb53-14"><a href="#cb53-14" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" tabindex="-1"></a><span class="cf">if</span> fecha_inicio_input:</span>
<span id="cb53-16"><a href="#cb53-16" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb53-17"><a href="#cb53-17" tabindex="-1"></a>        startDate <span class="op">=</span> dt.datetime.strptime(fecha_inicio_input, <span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st">&quot;</span>)</span>
<span id="cb53-18"><a href="#cb53-18" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb53-19"><a href="#cb53-19" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Formato de fecha inválido. Use YYYY-MM-DD.&quot;</span>)</span>
<span id="cb53-20"><a href="#cb53-20" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb53-21"><a href="#cb53-21" tabindex="-1"></a>    <span class="co"># Si el usuario no proporciona una fecha de inicio, restamos &quot;years&quot;</span></span>
<span id="cb53-22"><a href="#cb53-22" tabindex="-1"></a>    years <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese el número de años de datos históricos: &quot;</span>) <span class="kw">or</span> <span class="dv">15</span>)</span>
<span id="cb53-23"><a href="#cb53-23" tabindex="-1"></a>    <span class="cf">if</span> years <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb53-24"><a href="#cb53-24" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de años debe ser mayor que 0.&quot;</span>)</span>
<span id="cb53-25"><a href="#cb53-25" tabindex="-1"></a>    startDate <span class="op">=</span> endDate <span class="op">-</span> relativedelta(years<span class="op">=</span>years)</span>
<span id="cb53-26"><a href="#cb53-26" tabindex="-1"></a></span>
<span id="cb53-27"><a href="#cb53-27" tabindex="-1"></a><span class="co"># 🔹 Lista de tickers a analizar (se puede modificar)</span></span>
<span id="cb53-28"><a href="#cb53-28" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">&#39;SPY&#39;</span>, <span class="st">&#39;BND&#39;</span>, <span class="st">&#39;GLD&#39;</span>, <span class="st">&#39;QQQ&#39;</span>, <span class="st">&#39;VTI&#39;</span>]</span>
<span id="cb53-29"><a href="#cb53-29" tabindex="-1"></a></span>
<span id="cb53-30"><a href="#cb53-30" tabindex="-1"></a><span class="co"># 🔹 Mostrar información</span></span>
<span id="cb53-31"><a href="#cb53-31" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔹 Obteniendo datos desde </span><span class="sc">{</span>startDate<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> hasta </span><span class="sc">{</span>endDate<span class="sc">.</span>date()<span class="sc">}</span><span class="ss">.&quot;</span>)</span>
<span id="cb53-32"><a href="#cb53-32" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;🔹 Tickers seleccionados: </span><span class="sc">{</span><span class="st">&#39;, &#39;</span><span class="sc">.</span>join(tickers)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>🔹 Obteniendo datos desde 2010-04-07 hasta 2025-04-07.
🔹 Tickers seleccionados: SPY, BND, GLD, QQQ, VTI</code></pre>
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="co"># Descargar datos de los tickers seleccionados</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>data <span class="op">=</span> yf.download(tickers, start<span class="op">=</span>startDate, end<span class="op">=</span>endDate)</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a><span class="co"># 🔍 Imprimir las columnas disponibles</span></span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a><span class="co">#print(&quot;Columnas disponibles:&quot;, data.columns)</span></span>
<span id="cb55-6"><a href="#cb55-6" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" tabindex="-1"></a><span class="co"># Extraer los datos de cierre correctamente desde MultiIndex</span></span>
<span id="cb55-8"><a href="#cb55-8" tabindex="-1"></a>adj_close_df <span class="op">=</span> data.xs(<span class="st">&#39;Close&#39;</span>, level<span class="op">=</span><span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Obtiene solo los valores de &#39;Close&#39;</span></span>
<span id="cb55-9"><a href="#cb55-9" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" tabindex="-1"></a><span class="co"># Manejo de valores faltantes (sin warning)</span></span>
<span id="cb55-11"><a href="#cb55-11" tabindex="-1"></a>adj_close_df <span class="op">=</span> adj_close_df.ffill().dropna()</span>
<span id="cb55-12"><a href="#cb55-12" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" tabindex="-1"></a><span class="co"># Mostrar resultado</span></span>
<span id="cb55-14"><a href="#cb55-14" tabindex="-1"></a><span class="co">#print(adj_close_df.head())</span></span>
<span id="cb55-15"><a href="#cb55-15" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" tabindex="-1"></a><span class="co"># Imprimir los primeros 10 registros en formato tabular</span></span>
<span id="cb55-17"><a href="#cb55-17" tabindex="-1"></a><span class="bu">print</span>(tabulate(adj_close_df.head(<span class="dv">10</span>), headers<span class="op">=</span><span class="st">&quot;keys&quot;</span>, tablefmt<span class="op">=</span><span class="st">&quot;fancy_grid&quot;</span>))</span></code></pre></div>
<pre><code>YF.download() has changed argument auto_adjust default to True


[*********************100%***********************]  5 of 5 completed

╒═════════════════════╤═════════╤════════╤═════════╤═════════╤═════════╕
│ Date                │     BND │    GLD │     QQQ │     SPY │     VTI │
╞═════════════════════╪═════════╪════════╪═════════╪═════════╪═════════╡
│ 2010-04-08 00:00:00 │ 51.301  │ 112.65 │ 42.5546 │ 90.2556 │ 46.2722 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-09 00:00:00 │ 51.3987 │ 113.64 │ 42.8078 │ 90.8484 │ 46.5853 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-12 00:00:00 │ 51.4508 │ 113.01 │ 42.8427 │ 90.9927 │ 46.6922 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-13 00:00:00 │ 51.555  │ 112.69 │ 43.061  │ 91.0611 │ 46.738  │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-14 00:00:00 │ 51.5159 │ 113.03 │ 43.5761 │ 92.0946 │ 47.3108 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-15 00:00:00 │ 51.5941 │ 113.65 │ 43.7682 │ 92.1706 │ 47.3719 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-16 00:00:00 │ 51.7047 │ 111.24 │ 43.2443 │ 90.7039 │ 46.6311 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-19 00:00:00 │ 51.6396 │ 111.15 │ 43.2182 │ 91.0459 │ 46.7533 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-20 00:00:00 │ 51.6917 │ 111.46 │ 43.4364 │ 91.859  │ 47.1962 │
├─────────────────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ 2010-04-21 00:00:00 │ 51.7308 │ 112.31 │ 43.6809 │ 91.6919 │ 47.1581 │
╘═════════════════════╧═════════╧════════╧═════════╧═════════╧═════════╛</code></pre>
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a><span class="co"># Graficar los precios de cierre</span></span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a><span class="co"># Configurar estilo minimalista</span></span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>sns.set_style(<span class="st">&quot;white&quot;</span>)  <span class="co"># Fondo blanco sin líneas</span></span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a><span class="co"># Obtener colores suaves de Seaborn</span></span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;muted&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(adj_close_df.columns))</span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" tabindex="-1"></a><span class="co"># Graficar cada activo con colores suaves</span></span>
<span id="cb57-11"><a href="#cb57-11" tabindex="-1"></a><span class="cf">for</span> i, ticker <span class="kw">in</span> <span class="bu">enumerate</span>(adj_close_df.columns):</span>
<span id="cb57-12"><a href="#cb57-12" tabindex="-1"></a>    plt.plot(adj_close_df.index, adj_close_df[ticker], label<span class="op">=</span>ticker, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>colors[i])</span>
<span id="cb57-13"><a href="#cb57-13" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" tabindex="-1"></a><span class="co"># Agregar títulos y etiquetas</span></span>
<span id="cb57-15"><a href="#cb57-15" tabindex="-1"></a>plt.title(<span class="st">&quot;Evolución de los Precios de Cierre Ajustados&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb57-16"><a href="#cb57-16" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb57-17"><a href="#cb57-17" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Precio de Cierre Ajustado (USD)&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb57-18"><a href="#cb57-18" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" tabindex="-1"></a><span class="co"># Eliminar bordes superiores y derechos para un look más limpio</span></span>
<span id="cb57-20"><a href="#cb57-20" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">False</span>, bottom<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb57-21"><a href="#cb57-21" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" tabindex="-1"></a><span class="co"># Rotar fechas para mejor visibilidad</span></span>
<span id="cb57-23"><a href="#cb57-23" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb57-24"><a href="#cb57-24" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" tabindex="-1"></a><span class="co"># Agregar leyenda con un diseño discreto</span></span>
<span id="cb57-26"><a href="#cb57-26" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&quot;Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">10</span>, loc<span class="op">=</span><span class="st">&quot;upper left&quot;</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb57-27"><a href="#cb57-27" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" tabindex="-1"></a><span class="co"># Mostrar la gráfica</span></span>
<span id="cb57-29"><a href="#cb57-29" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_53_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-2-calcular-los-rendimientos-logarítmicos-2">📌 Paso 2:
Calcular los rendimientos logarítmicos</h2>
<p>Una vez que tenemos los datos históricos de los activos financieros,
el siguiente paso es calcular los <strong>rendimientos
logarítmicos</strong>.</p>
<p>Los rendimientos logarítmicos se calculan con la siguiente
fórmula:</p>
<p><span class="math display">$$
\begin{aligned}
r_t &amp;= \ln\left(\frac{P_t}{P_{t-1}}\right) \\
\text{donde:} \\
r_t &amp;= \text{rendimiento logarítmico en el período } t, \\
P_t &amp;= \text{precio del activo en el período actual}, \\
P_{t-1} &amp;= \text{precio del activo en el período anterior}.
\end{aligned}
$$</span></p>
<p>🔍 <strong>Objetivo</strong>: Obtener una serie de rendimientos que
nos permitan analizar la distribución del riesgo en el portafolio.</p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="co"># Solicitar al usuario el número de días para la ventana móvil</span></span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese el número de días para calcular los rendimientos acumulados: &quot;</span>))</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a><span class="co"># Calcular los rendimientos acumulados en la ventana de &#39;days&#39; días</span></span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a>historical_x_day_returns <span class="op">=</span> historical_returns.rolling(window<span class="op">=</span>days).<span class="bu">sum</span>()</span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a><span class="co"># Eliminar valores NaN generados por la ventana móvil</span></span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a>historical_x_day_returns.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-9"><a href="#cb58-9" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" tabindex="-1"></a><span class="co"># Mostrar los primeros valores calculados</span></span>
<span id="cb58-11"><a href="#cb58-11" tabindex="-1"></a><span class="bu">print</span>(historical_x_day_returns.head())</span></code></pre></div>
<pre><code>Date
2010-04-15    0.015962
2010-04-16   -0.003407
2010-04-19   -0.002254
2010-04-20    0.001694
2010-04-21   -0.001804
dtype: float64</code></pre>
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a><span class="co"># Crear la figura</span></span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a><span class="co"># Obtener colores de Seaborn</span></span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">&quot;deep&quot;</span>, n_colors<span class="op">=</span><span class="bu">len</span>(log_returns.columns))</span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a><span class="co"># Graficar cada activo</span></span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a><span class="cf">for</span> ticker, color <span class="kw">in</span> <span class="bu">zip</span>(log_returns.columns, colors):</span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a>    plt.plot(log_returns.index, log_returns[ticker], label<span class="op">=</span>ticker, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" tabindex="-1"></a><span class="co"># Mejorar la leyenda</span></span>
<span id="cb60-13"><a href="#cb60-13" tabindex="-1"></a>plt.legend(</span>
<span id="cb60-14"><a href="#cb60-14" tabindex="-1"></a>    title<span class="op">=</span><span class="st">&quot;Activos Financieros&quot;</span>, title_fontsize<span class="op">=</span><span class="dv">12</span>, fontsize<span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb60-15"><a href="#cb60-15" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>), frameon<span class="op">=</span><span class="va">True</span>, fancybox<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span></span>
<span id="cb60-16"><a href="#cb60-16" tabindex="-1"></a>)</span>
<span id="cb60-17"><a href="#cb60-17" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" tabindex="-1"></a><span class="co"># Mejorar etiquetas y título</span></span>
<span id="cb60-19"><a href="#cb60-19" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos de los Activos&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb60-20"><a href="#cb60-20" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb60-21"><a href="#cb60-21" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb60-22"><a href="#cb60-22" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)  <span class="co"># Línea base en 0</span></span>
<span id="cb60-23"><a href="#cb60-23" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)  <span class="co"># Líneas de fondo más sutiles</span></span>
<span id="cb60-24"><a href="#cb60-24" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb60-25"><a href="#cb60-25" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb60-27"><a href="#cb60-27" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_56_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<h2 id="paso-3-asignación-de-pesos-a-los-activos-3">📌 Paso 3:
Asignación de Pesos a los Activos</h2>
<p>Una vez calculados los <strong>rendimientos logarítmicos</strong>, el
siguiente paso es asignar los pesos a cada activo dentro del portafolio.
Estos pesos representan la proporción del capital invertido en cada
activo y juegan un papel clave en la determinación del <strong>riesgo
total</strong>.</p>
<h3 id="métodos-para-asignar-los-pesos-3">🎯 Métodos para asignar los
pesos</h3>
<p>Existen diferentes estrategias para asignar los pesos en un
portafolio:</p>
<ul>
<li><strong>Pesos iguales</strong> 📊: Se asigna el mismo porcentaje a
cada activo.<br />
</li>
<li><strong>Proporcional al valor de mercado</strong> 💰: Se basa en la
capitalización de mercado de cada activo.<br />
</li>
<li><strong>Optimización de riesgo-retorno</strong> 📈: Se ajustan los
pesos para minimizar la volatilidad o maximizar el rendimiento
esperado.</li>
</ul>
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="co"># Definir el valor total del portafolio  </span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>portfolio_value <span class="op">=</span> <span class="dv">1_000_000</span>  <span class="co"># 1 millón de dólares  </span></span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a><span class="co"># Asignar pesos a los activos (deben sumar 1 y coincidir con los tickers)  </span></span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>])  </span>
<span id="cb61-7"><a href="#cb61-7" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" tabindex="-1"></a><span class="co"># Validaciones: Asegurar que los pesos coincidan con el número de activos y sumen 1  </span></span>
<span id="cb61-9"><a href="#cb61-9" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(weights) <span class="op">!=</span> <span class="bu">len</span>(tickers):  </span>
<span id="cb61-10"><a href="#cb61-10" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Error: Hay </span><span class="sc">{</span><span class="bu">len</span>(tickers)<span class="sc">}</span><span class="ss"> activos, pero </span><span class="sc">{</span><span class="bu">len</span>(weights)<span class="sc">}</span><span class="ss"> pesos asignados.&quot;</span>)  </span>
<span id="cb61-11"><a href="#cb61-11" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> np.isclose(np.<span class="bu">sum</span>(weights), <span class="dv">1</span>):  </span>
<span id="cb61-13"><a href="#cb61-13" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Error: La suma de los pesos debe ser exactamente 1.&quot;</span>)  </span>
<span id="cb61-14"><a href="#cb61-14" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" tabindex="-1"></a><span class="co"># Mostrar los pesos asignados  </span></span>
<span id="cb61-16"><a href="#cb61-16" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;✅ Pesos asignados correctamente:&quot;</span>, weights)  </span></code></pre></div>
<pre><code>Rendimiento Esperado del Portafolio: 0.000347
Desviación Estándar del Portafolio: 0.106980</code></pre>
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="co"># Calcular los rendimientos históricos del portafolio</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a><span class="co"># Multiplicamos los rendimientos logarítmicos de cada activo por su peso en el portafolio</span></span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>historical_returns <span class="op">=</span> (log_returns <span class="op">*</span> weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a><span class="co"># Imprimir los rendimientos históricos del portafolio</span></span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a><span class="bu">print</span>(historical_returns)</span></code></pre></div>
<pre><code>Date
2010-04-09    0.006175
2010-04-12   -0.000755
2010-04-13    0.000819
2010-04-14    0.006606
2010-04-15    0.003118
                ...   
2025-04-01    0.002541
2025-04-02    0.003955
2025-04-03   -0.027060
2025-04-04   -0.037876
2025-04-07   -0.009143
Length: 3773, dtype: float64</code></pre>
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)  <span class="co"># Estilo limpio</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a><span class="co"># Graficar los rendimientos históricos del portafolio</span></span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>plt.plot(historical_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="st">&quot;Rendimientos Históricos&quot;</span>)</span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a><span class="co"># Títulos y etiquetas</span></span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a>plt.title(<span class="st">&quot;Rendimientos Logarítmicos del Portafolio&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento Logarítmico&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" tabindex="-1"></a><span class="co"># Agregar línea base en y=0</span></span>
<span id="cb65-13"><a href="#cb65-13" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb65-14"><a href="#cb65-14" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" tabindex="-1"></a><span class="co"># Leyenda mejorada</span></span>
<span id="cb65-16"><a href="#cb65-16" tabindex="-1"></a>plt.legend(frameon<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&quot;upper right&quot;</span>)</span>
<span id="cb65-17"><a href="#cb65-17" tabindex="-1"></a></span>
<span id="cb65-18"><a href="#cb65-18" tabindex="-1"></a><span class="co"># Mostrar gráfico</span></span>
<span id="cb65-19"><a href="#cb65-19" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_60_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># Permitir que el usuario defina la ventana de días</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Ingrese la cantidad de días para la ventana móvil: &quot;</span>))</span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a><span class="co"># Validar que el valor ingresado sea positivo y razonable</span></span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a><span class="cf">if</span> days <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> days <span class="op">&gt;</span> <span class="bu">len</span>(historical_returns):</span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;El número de días debe estar entre 1 y el total de registros disponibles.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="co"># Graficar los rendimientos acumulados</span></span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>plt.plot(range_returns, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;Rendimiento acumulado (</span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días)&#39;</span>)</span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">&quot;black&quot;</span>, linestyle<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="dv">1</span>)  <span class="co"># Línea en 0 para referencia</span></span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Fecha&quot;</span>)</span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Rendimiento acumulado&quot;</span>)</span>
<span id="cb67-7"><a href="#cb67-7" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Rendimientos Acumulados en Ventanas de </span><span class="sc">{</span>days<span class="sc">}</span><span class="ss"> días&quot;</span>)</span>
<span id="cb67-8"><a href="#cb67-8" tabindex="-1"></a>plt.legend()</span>
<span id="cb67-9"><a href="#cb67-9" tabindex="-1"></a>plt.show()</span></code></pre></div>
<pre><code>---------------------------------------------------------------------------


NameError                                 Traceback (most recent call last)


Cell In[56], line 3


      1 # Graficar los rendimientos acumulados


      2 plt.figure(figsize=(12, 6))


----&gt; 3 plt.plot(range_returns, color=&quot;royalblue&quot;, linewidth=2, label=f&#39;Rendimiento acumulado ({days} días)&#39;)


      4 plt.axhline(y=0, color=&quot;black&quot;, linestyle=&quot;--&quot;, linewidth=1)  # Línea en 0 para referencia


      5 plt.xlabel(&quot;Fecha&quot;)





NameError: name &#39;range_returns&#39; is not defined



&lt;Figure size 1200x600 with 0 Axes&gt;</code></pre>
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="kw">def</span> expected_return(weights, log_returns):</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a><span class="co">    Calcula el rendimiento esperado del portafolio.</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a><span class="co">    Parámetros:</span></span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a><span class="co">    - weights: array de los pesos asignados a cada activo en el portafolio.</span></span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a><span class="co">    - log_returns: DataFrame con los rendimientos logarítmicos históricos de los activos.</span></span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb69-10"><a href="#cb69-10" tabindex="-1"></a><span class="co">    - El rendimiento esperado del portafolio.</span></span>
<span id="cb69-11"><a href="#cb69-11" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb69-12"><a href="#cb69-12" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(log_returns.mean() <span class="op">*</span> weights)</span>
<span id="cb69-13"><a href="#cb69-13" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" tabindex="-1"></a><span class="kw">def</span> standard_deviation(weights, cov_matrix):</span>
<span id="cb69-16"><a href="#cb69-16" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb69-17"><a href="#cb69-17" tabindex="-1"></a><span class="co">    Calcula la desviación estándar (volatilidad) del portafolio.</span></span>
<span id="cb69-18"><a href="#cb69-18" tabindex="-1"></a></span>
<span id="cb69-19"><a href="#cb69-19" tabindex="-1"></a><span class="co">    Parámetros:</span></span>
<span id="cb69-20"><a href="#cb69-20" tabindex="-1"></a><span class="co">    - weights: array de los pesos asignados a cada activo en el portafolio.</span></span>
<span id="cb69-21"><a href="#cb69-21" tabindex="-1"></a><span class="co">    - cov_matrix: matriz de covarianza de los rendimientos de los activos.</span></span>
<span id="cb69-22"><a href="#cb69-22" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb69-24"><a href="#cb69-24" tabindex="-1"></a><span class="co">    - La desviación estándar del portafolio.</span></span>
<span id="cb69-25"><a href="#cb69-25" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb69-26"><a href="#cb69-26" tabindex="-1"></a>    variance <span class="op">=</span> weights.T <span class="op">@</span> cov_matrix <span class="op">@</span> weights  <span class="co"># Calcula la varianza del portafolio</span></span>
<span id="cb69-27"><a href="#cb69-27" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(variance)  <span class="co"># Retorna la raíz cuadrada de la varianza (desviación estándar)</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="co"># Crear la matriz de covarianza para todos los activos</span></span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>cov_matrix <span class="op">=</span> log_returns.cov()</span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" tabindex="-1"></a><span class="co"># Mostrar la matriz de covarianza en pantalla</span></span>
<span id="cb70-5"><a href="#cb70-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;📊 Matriz de Covarianza de los Activos:&quot;</span>)</span>
<span id="cb70-6"><a href="#cb70-6" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(cov_matrix).<span class="bu">round</span>(<span class="dv">6</span>).to_string())</span></code></pre></div>
<pre><code>📊 Matriz de Covarianza de los Activos:
Ticker       BND       GLD       QQQ       SPY       VTI
Ticker                                                  
BND     0.000009  0.000009  0.000001  0.000000  0.000000
GLD     0.000009  0.000095  0.000007  0.000005  0.000006
QQQ     0.000001  0.000007  0.000170  0.000132  0.000135
SPY     0.000000  0.000005  0.000132  0.000118  0.000121
VTI     0.000000  0.000006  0.000135  0.000121  0.000124</code></pre>
<h2
id="paso-4-generar-múltiples-escenarios-posibles-de-precios-futuros">📌Paso
4: Generar Múltiples Escenarios Posibles de Precios Futuros</h2>
<p>En la metodología de Simulación Monte Carlo, uno de los pasos
fundamentales es la generación de escenarios aleatorios que representen
posibles caminos futuros del comportamiento del mercado. Estos
escenarios se crean con base en las estadísticas históricas del
portafolio.</p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="co"># 🎲 Función para generar un puntaje Z aleatorio de una distribución normal estándar</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a><span class="kw">def</span> random_z_score():</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>    <span class="cf">return</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a><span class="co"># 📅 Definir el horizonte de días para la simulación</span></span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a>days <span class="op">=</span> <span class="dv">20</span>  </span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a><span class="co"># 📉 Función para calcular la pérdida o ganancia en un escenario simulado</span></span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a><span class="kw">def</span> scenario_gain_loss(portfolio_value, portfolio_std_dev, z_score, portfolio_expected_return, days):</span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a><span class="co">    Calcula la ganancia o pérdida del portafolio en un escenario simulado.</span></span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" tabindex="-1"></a><span class="co">    Parámetros:</span></span>
<span id="cb72-14"><a href="#cb72-14" tabindex="-1"></a><span class="co">    - portfolio_value: Valor total del portafolio.</span></span>
<span id="cb72-15"><a href="#cb72-15" tabindex="-1"></a><span class="co">    - portfolio_std_dev: Desviación estándar (volatilidad) del portafolio.</span></span>
<span id="cb72-16"><a href="#cb72-16" tabindex="-1"></a><span class="co">    - z_score: Valor aleatorio de una distribución normal estándar.</span></span>
<span id="cb72-17"><a href="#cb72-17" tabindex="-1"></a><span class="co">    - portfolio_expected_return: Rendimiento esperado del portafolio.</span></span>
<span id="cb72-18"><a href="#cb72-18" tabindex="-1"></a><span class="co">    - days: Número de días del horizonte temporal.</span></span>
<span id="cb72-19"><a href="#cb72-19" tabindex="-1"></a></span>
<span id="cb72-20"><a href="#cb72-20" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb72-21"><a href="#cb72-21" tabindex="-1"></a><span class="co">    - Ganancia o pérdida estimada en el portafolio.</span></span>
<span id="cb72-22"><a href="#cb72-22" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb72-23"><a href="#cb72-23" tabindex="-1"></a>    <span class="co"># 📈 Componente de rendimiento esperado</span></span>
<span id="cb72-24"><a href="#cb72-24" tabindex="-1"></a>    expected_return_component <span class="op">=</span> portfolio_value <span class="op">*</span> portfolio_expected_return <span class="op">*</span> days  </span>
<span id="cb72-25"><a href="#cb72-25" tabindex="-1"></a></span>
<span id="cb72-26"><a href="#cb72-26" tabindex="-1"></a>    <span class="co"># 📊 Componente de riesgo basado en volatilidad y distribución normal</span></span>
<span id="cb72-27"><a href="#cb72-27" tabindex="-1"></a>    risk_component <span class="op">=</span> portfolio_value <span class="op">*</span> portfolio_std_dev <span class="op">*</span> z_score <span class="op">*</span> np.sqrt(days)  </span>
<span id="cb72-28"><a href="#cb72-28" tabindex="-1"></a></span>
<span id="cb72-29"><a href="#cb72-29" tabindex="-1"></a>    <span class="cf">return</span> expected_return_component <span class="op">+</span> risk_component</span>
<span id="cb72-30"><a href="#cb72-30" tabindex="-1"></a></span>
<span id="cb72-31"><a href="#cb72-31" tabindex="-1"></a><span class="co"># 🔍 Prueba de la función con un puntaje Z aleatorio</span></span>
<span id="cb72-32"><a href="#cb72-32" tabindex="-1"></a>z_test <span class="op">=</span> random_z_score()</span>
<span id="cb72-33"><a href="#cb72-33" tabindex="-1"></a>test_scenario <span class="op">=</span> scenario_gain_loss(portfolio_value<span class="op">=</span><span class="dv">1_000_000</span>, </span>
<span id="cb72-34"><a href="#cb72-34" tabindex="-1"></a>                                   portfolio_std_dev<span class="op">=</span><span class="fl">0.02</span>, </span>
<span id="cb72-35"><a href="#cb72-35" tabindex="-1"></a>                                   z_score<span class="op">=</span>z_test, </span>
<span id="cb72-36"><a href="#cb72-36" tabindex="-1"></a>                                   portfolio_expected_return<span class="op">=</span><span class="fl">0.0005</span>, </span>
<span id="cb72-37"><a href="#cb72-37" tabindex="-1"></a>                                   days<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb72-38"><a href="#cb72-38" tabindex="-1"></a></span>
<span id="cb72-39"><a href="#cb72-39" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;📌 Escenario simulado de ganancia/pérdida: $</span><span class="sc">{</span>test_scenario<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>📌 Escenario simulado de ganancia/pérdida: $109,331.86</code></pre>
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="co"># 🔢 Parámetros del modelo</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>simulations <span class="op">=</span> <span class="dv">10000</span>  <span class="co"># Número de simulaciones</span></span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>days <span class="op">=</span> <span class="dv">20</span>  <span class="co"># Horizonte temporal</span></span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a><span class="co"># 📌 Generar 10,000 valores de z-score de una distribución normal estándar</span></span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a>z_scores <span class="op">=</span> np.random.normal(<span class="dv">0</span>, <span class="dv">1</span>, simulations)</span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a><span class="co"># 📉 Calcular las pérdidas o ganancias para cada simulación</span></span>
<span id="cb74-9"><a href="#cb74-9" tabindex="-1"></a>scenarioReturn <span class="op">=</span> portfolio_value <span class="op">*</span> portfolio_expected_return <span class="op">*</span> days <span class="op">+</span> <span class="op">\</span></span>
<span id="cb74-10"><a href="#cb74-10" tabindex="-1"></a>                 portfolio_value <span class="op">*</span> portfolio_std_dev <span class="op">*</span> z_scores <span class="op">*</span> np.sqrt(days)</span>
<span id="cb74-11"><a href="#cb74-11" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" tabindex="-1"></a><span class="co"># 📊 Mostrar los primeros 10 resultados</span></span>
<span id="cb74-13"><a href="#cb74-13" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;📈 Muestra de 10 escenarios simulados de ganancia/pérdida:&quot;</span>)</span>
<span id="cb74-14"><a href="#cb74-14" tabindex="-1"></a><span class="bu">print</span>(scenarioReturn[:<span class="dv">10</span>])</span></code></pre></div>
<pre><code>📈 Muestra de 10 escenarios simulados de ganancia/pérdida:
[ -189973.00839     -708143.96553103  -396555.88439723   264321.90126602
   274009.6089572   -285498.13565401 -1048906.64058674    75789.30989018
  -184719.25385867  -568458.1371545 ]</code></pre>
<h2 id="paso-5-implementación-de-los-métodos-de-cálculo-del-var">📌 Paso
5: Implementación de los Métodos de Cálculo del VaR</h2>
<p>Una vez definidos los pesos del portafolio, el siguiente paso
consiste en implementar los diferentes métodos de cálculo del Valor en
Riesgo (VaR). Este valor representa la pérdida máxima esperada en un
horizonte temporal determinado y con un cierto nivel de confianza.</p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="co"># Verificar que hay simulaciones antes de calcular el VaR</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(scenarioReturn) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;No hay datos en &#39;scenarioReturn&#39;. Verifica las simulaciones.&quot;</span>)</span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a><span class="co"># Calcular el VaR al nivel de confianza especificado</span></span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a>VaR <span class="op">=</span> <span class="op">-</span>np.percentile(scenarioReturn, <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> confidence_interval))</span>
<span id="cb76-7"><a href="#cb76-7" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" tabindex="-1"></a><span class="co"># Imprimir resultado con formato claro</span></span>
<span id="cb76-9"><a href="#cb76-9" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Value at Risk (VaR) al </span><span class="sc">{</span>confidence_interval<span class="sc">:.0%}</span><span class="ss"> de confianza: $</span><span class="sc">{</span>VaR<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<pre><code>Value at Risk (VaR) al 99% de confianza: $61,416.22</code></pre>
<h2 id="paso-6-visualización-de-los-resultados-mediante-gráficos">📌
Paso 6: Visualización de los Resultados mediante Gráficos</h2>
<p>Una vez calculado el VaR utilizando los distintos métodos, es
fundamental visualizar los resultados para interpretar de forma clara y
rápida el riesgo del portafolio.</p>
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a> <span class="co">#Crear el histograma de las simulaciones</span></span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a>sns.histplot(scenarioReturn, bins<span class="op">=</span><span class="dv">50</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&quot;royalblue&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb78-4"><a href="#cb78-4" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" tabindex="-1"></a><span class="co"># 📍 Agregar líneas para los percentiles clave</span></span>
<span id="cb78-6"><a href="#cb78-6" tabindex="-1"></a>percentiles <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">1</span>]  <span class="co"># VaR al 95% y 99%</span></span>
<span id="cb78-7"><a href="#cb78-7" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> percentiles:</span>
<span id="cb78-8"><a href="#cb78-8" tabindex="-1"></a>    VaR <span class="op">=</span> np.percentile(scenarioReturn, p)</span>
<span id="cb78-9"><a href="#cb78-9" tabindex="-1"></a>    plt.axvline(VaR, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f&#39;VaR </span><span class="sc">{</span><span class="dv">100</span> <span class="op">-</span> p<span class="sc">}</span><span class="ss">%: $</span><span class="sc">{</span>VaR<span class="sc">:,</span><span class="fl">.2</span><span class="er">f</span><span class="sc">}</span><span class="ss">&#39;</span>)</span>
<span id="cb78-10"><a href="#cb78-10" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" tabindex="-1"></a><span class="co"># 🎨 Personalizar el gráfico</span></span>
<span id="cb78-12"><a href="#cb78-12" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Distribución de los Retornos Simulados (</span><span class="sc">{</span>simulations<span class="sc">}</span><span class="ss"> simulaciones)&quot;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb78-13"><a href="#cb78-13" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Ganancia/Pérdida del Portafolio ($)&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb78-14"><a href="#cb78-14" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Frecuencia&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb78-15"><a href="#cb78-15" tabindex="-1"></a>plt.legend()</span>
<span id="cb78-16"><a href="#cb78-16" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb78-17"><a href="#cb78-17" tabindex="-1"></a></span>
<span id="cb78-18"><a href="#cb78-18" tabindex="-1"></a><span class="co"># 📊 Mostrar el gráfico</span></span>
<span id="cb78-19"><a href="#cb78-19" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="float">
<img src="Var_Methods_files/Var_Methods_71_0.png" alt="png" />
<div class="figcaption">png</div>
</div>
